<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aeroxchange: Profile</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gruppo&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Gruppo&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="Profile.css" type="text/css" />
    <link rel="stylesheet" href="invest.css" type="text/css">
  </head>
  <body>
    <nav class="navbar" id="navbar">
      <h1 class="navtitle">AEROXCHANGE</h1>
      <div class="listbtn">
        <ul class="list">
          <a href="index.html" id="homesec">Home</a>
          <a href="invest.html" id="invest">Invest</a>
          <a href="Profile.html" id="aboutus">Profile</a>
          <a href="aboutus.html" id="aboutus">About Us</a>
        </ul>
        <button class="contactus" style="color: black">
          <a href="contactus.html">Contact Us</a>
        </button>
      </div>
    </nav>

    <div class="maincontainer">
      <div class="profilesection">
        <img src="usericon.png" alt="" />
        <div class="namecontainer">
          <h3 id="userName"></h3>
        </div>
        <p id="userEmail"></p>
        <p id="userMobielNo"></p>
        <button id="logoutbtn">Logout</button>
      </div>
      <div class="investmentsection" id="investmentsection">
        <h1>Portfolio</h1>
      </div>
    </div>

    <div class="popup-container" id="popup-container">
      <div class="popup-content">
        <button class="close-button" onclick="closePopup()">âœ–</button>
        <h2 class="company-name">AEROXCHANGE</h2>
        <div class="airplane-thumbnail">
          <img src="./airbusa380.jpg" alt="Airbus A380" />
        </div>
        <div class="input-fields">
          <label for="num-tokens">No. of tokens to sell (minimum 1):</label>
          <input
            type="number"
            id="num-tokens"
            min="1"
            max="1"
            onchange="getTotalAmount()"
          />
          <p class="totalamount" id="totalamount">
            Total amount: <span id="total-amount-rupees">1000</span> INR
          </p>
          <p>
            Equivalent in Ethereum: <span id="total-amount-ethereum"></span> ETH
          </p>
          <p class="walletpara">Enter your MetaMask Wallet Address: </p>
          <input type="text" name="" id="senderWaddressinput">
          <p class="walletpara1">Enter receiver's MetaMask Wallet Address: </p>
          <input type="text" name="" id="receiverWaddressinput">

        </div>
        <button class="buy-button" id="sellonmetamask">sell</button>
      </div>
    </div>
    
    <script
      src="https://kit.fontawesome.com/e26316daf2.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.3/dist/web3.min.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      document.getElementById("logoutbtn").addEventListener("click", (e) => {
        const firebaseConfigcheck = {
          apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
          authDomain: "aeroxchange-d99ca.firebaseapp.com",
          projectId: "aeroxchange-d99ca",
          storageBucket: "aeroxchange-d99ca.appspot.com",
          messagingSenderId: "243314062567",
          appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
        };

        const firebaseAppcheck = initializeApp(firebaseConfigcheck);
        const authcheck = getAuth(firebaseAppcheck);
        function logout() {
          signOut(authcheck)
            .then(() => {
              // Sign-out successful.
              console.log("User signed out");
              window.location.href = "loginPage.html";
            })
            .catch((error) => {
              // An error happened.
              console.error("Error signing out:", error);
            });
        }

        logout();
      });
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

      const firebaseConfiggetdata = {
        apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
        authDomain: "aeroxchange-d99ca.firebaseapp.com",
        projectId: "aeroxchange-d99ca",
        storageBucket: "aeroxchange-d99ca.appspot.com",
        messagingSenderId: "243314062567",
        appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
      };

      const firebaseAppgetdata = initializeApp(firebaseConfiggetdata);
      const authgetdata = getAuth(firebaseAppgetdata);
      const db = getDatabase(firebaseAppgetdata);

      // function to get the current user email

      function getuserEmail() {
        onAuthStateChanged(authgetdata, (user) => {
          if (user) {
            get(ref(db, "users/" + user.email.replace(".", "_"))).then(
              (snapshot) => {
                const userData = snapshot.val();
                document.getElementById("userName").innerText =
                  userData.username;
                document.getElementById("userEmail").innerText =
                  userData.useremail;
                document.getElementById("userMobielNo").innerText =
                  userData.usermobile;
              }
            );
          }
        });
      }

      getuserEmail();
    </script>

    <script type="module">
      // Here we are trying to access the data sended from the invest section

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      import {
        getDatabase,
        ref,
        set,
        get,
        child,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

      const firebaseConfiggetInvestdata = {
        apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
        authDomain: "aeroxchange-d99ca.firebaseapp.com",
        projectId: "aeroxchange-d99ca",
        storageBucket: "aeroxchange-d99ca.appspot.com",
        messagingSenderId: "243314062567",
        appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
      };

      const firebaseAppsendInvestData = initializeApp(
        firebaseConfiggetInvestdata
      );
      const authgetInvestdata = getAuth(firebaseAppsendInvestData);
      const Investdb = getDatabase(firebaseAppsendInvestData);

      onAuthStateChanged(authgetInvestdata, (user) => {
        if (user) {
          get(ref(Investdb, "InvestorDetails/" + user.email.replace(".", "_"))).then(
            (snapshot) => {
              const userData = snapshot.val();

              const tokens = userData.tokens;
              const amount = userData.Amount;
              const equivalentEth = userData.EthereumEque;
              const modelname = userData.Model;

              document.getElementById("num-tokens").max = tokens;
              document.getElementById("num-tokens").value = 1;
              document.getElementById("total-amount-rupees").innerText = amount;
              document.getElementById('total-amount-ethereum').innerText = equivalentEth;


              if (tokens && amount && equivalentEth) {
                var profileDiv = document.createElement("div");
                profileDiv.classList.add("investmentsprofilediv");

                // Populate profile section
                profileDiv.innerHTML = `
        <h1 class="modelheading">${modelname}</h1>
        <p class="tokenspara">No. of tokens bought: ${tokens}</p>
        <p class="amountpara">Amount spent: ${amount}</p>
        <p class="ethereumpara">Equivalent Ethereum: ${equivalentEth}</p>
        <div class="sellbtndiv">
          <button class="sellbtn" id="sellbtn" onclick="sellonMetaMask()">sell</button>
        </div>`;

                // Append the new profile section
                document
                  .getElementById("investmentsection")
                  .appendChild(profileDiv);
              }
            }
          );
        }
      });
    </script>

    <script src="Profile.js" type="text/javascript"></script>
  </body>
</html>
