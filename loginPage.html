<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AEROXCHANGE:login & Signup</title>
    <link rel="stylesheet" href="loginPage.css" type="text/css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gruppo&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Gruppo&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="loginpagemain">
      <div class="loginpage">
        <div class="image">
          <div class="content">
            <p>
              Welcome to
              <span
              id="spantag"
                style="
                  font-family: 'Gruppo', sans-serif;
                  font-weight: 700;
                  color: white;
                  margin: 5px;
                ">AEROXCHANGE</span>
            </p>
          </div>
        </div>

        <!-- login details  -->

        <div class="info" id="info">
          <p class="info-para1">USER LOGIN</p>
          <input type="text" placeholder="Email" id="email" />
          <input type="password" placeholder="Password" id="password" />
          <!-- <button id="loginbtn"><a href="index.html">login</a></button> -->
          <button id="loginbtn">login</button>

          <div class="togosignup">
            <p class="signup-para1">
              Doesn't have an account yet?<button
                class="signupbtn"
                id="signupbtn"
              >
                Sign up
              </button>
            </p>

          </div>

          <p class="info-para2">OR</p>

          <div class="googlelogin">
            <img src="icons8-google-48.png" id="google-login" />
          </div>
        </div>

        <!-- Sign up details -->

        <div class="signupPage" id="signupPage">
          <p class="signuppage-para1">USER SIGNUP</p>
          <input type="text" placeholder="Name" id="signupName" />
          <input type="tel" placeholder="Mobile Number" id="signupMobile" />
          <input type="text" placeholder="Email" id="signupEmail" />
          <input type="text" placeholder="Password" id="signupPassword" />
          <button class="signupbutton" id="signupbutton">Sign up</button>
          <div class="backtologindiv">
            <p class="signuppage-para2">
              Already Have an account ?<button id="backtologin">Login</button>
            </p>
          </div>
        </div>
      </div>

    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        signInWithPopup,
        GoogleAuthProvider,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
        authDomain: "aeroxchange-d99ca.firebaseapp.com",
        projectId: "aeroxchange-d99ca",
        storageBucket: "aeroxchange-d99ca.appspot.com",
        messagingSenderId: "243314062567",
        appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
      };

      const firebaseApp = initializeApp(firebaseConfig);

      // Now you can use getAuth and signInWithEmailAndPassword methods
      const auth = getAuth(firebaseApp);
      const provider = new GoogleAuthProvider();

      document.getElementById("loginbtn").addEventListener("click", (e) => {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (email && password) {
          signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
              const user = userCredential.user;
              alert("Login Successful");
              window.location.href = "index.html";
            })
            .catch((error) => {
              const errorcode = error.code;
              const errormessage = error.message;
              alert("No credentails found, please sign up");
            });
        } else {
          alert("Please enter email and password");
        }
      });

      document.getElementById("google-login").addEventListener("click", (e) => {
        signInWithPopup(auth, provider)
          .then((result) => {
            const user = result.user;
            console.log(user);
            alert("Login successful");
            window.location.href = "index.html";
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.error(errorCode, errorMessage);
            alert("Error: " + errorMessage);
          });
      });
    </script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
      import { getDatabase, ref, set, get, child} from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";


      const firebaseConfiglogin = {
        apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
        authDomain: "aeroxchange-d99ca.firebaseapp.com",
        projectId: "aeroxchange-d99ca",
        storageBucket: "aeroxchange-d99ca.appspot.com",
        messagingSenderId: "243314062567",
        appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
      };

      const firebaseApplogin = initializeApp(firebaseConfiglogin);
      const authlogin = getAuth(firebaseApplogin);
      const db = getDatabase(firebaseApplogin);


      document.getElementById("signupbutton").addEventListener("click", (e) => {
        e.preventDefault();

        const signupemail = document.getElementById("signupEmail").value;
        const signuppassword = document.getElementById("signupPassword").value;
        const signupname = document.getElementById("signupName").value;
        const signupmobile = document.getElementById("signupMobile").value;

        // authenticate and sending data to the firebase

        if (signupemail && signuppassword && signupname && signupmobile) {

          // authenticating the user

          createUserWithEmailAndPassword(
            authlogin,
            signupemail,
            signuppassword
          ).then((userCredential) => {
            const user = userCredential.user;
            alert("Sign up successful.");
            window.location.href = "index.html";
          });


          //sending data to firebase

          set(ref(db, "users/" + signupemail.replace('.','_')),{
            username:signupname,
            useremail: signupemail,
            userpassword: signuppassword,
            usermobile: signupmobile
          })

        } else {
          alert("Please enter all the credentials");
        }
      });


    </script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
  } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";

  const firebaseConfigcheck = {
    apiKey: "AIzaSyAWNu1p2ivRTtmp3cAT04ifyicyxKNsvco",
    authDomain: "aeroxchange-d99ca.firebaseapp.com",
    projectId: "aeroxchange-d99ca",
    storageBucket: "aeroxchange-d99ca.appspot.com",
    messagingSenderId: "243314062567",
    appId: "1:243314062567:web:9b7aa93a1c0699a56ade42",
  };

  const firebaseAppcheck = initializeApp(firebaseConfigcheck);
  const authcheck = getAuth(firebaseAppcheck);

  onAuthStateChanged(authcheck, (user) => {
    if (user && window.location.pathname !== '/index.html') {
        // User is signed in and not on index.html
        console.log("User is signed in:", user);
        // Redirect to index.html
        window.location.href = 'index.html';
    } else if (!user && window.location.pathname !== '/loginPage.html') {
        // User is signed out and not on loginPage.html
        console.log("User is not signed in.");
        // Redirect to loginPage.html
        window.location.href = 'loginPage.html';
    }
  });

  // function logout() {
  //   signOut(auth)
  //     .then(() => {
  //       // Sign-out successful.
  //       console.log("User signed out");
  //     })
  //     .catch((error) => {
  //       // An error happened.
  //       console.error("Error signing out:", error);
  //     });
  // }
</script>

    <script src="loginPage.js" type="text/javascript"></script>
  </body>
</html>
